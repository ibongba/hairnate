<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="Description" content="Enter your description here" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" />
    <link rel="stylesheet" href="css/style.css" />

    <title>USER</title>
</head>

<body>
    <div id="nav"></div>
    <div class="container">
        <div class="row my-5">
            <div class="col-md-3 col-sm-12">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item w-100">
                        <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab">MY ORDER</a>
                    </li>
                    <li class="nav-item w-100">
                        <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab">PROFILE</a>
                    </li>
                    <li class="nav-item w-100">
                        <a class="nav-link" data-toggle="tab" href="#tabs-3" role="tab">MY ADDRESS</a>
                    </li>
                    <li class="nav-item w-100">
                        <a class="nav-link" data-toggle="tab" href="#tabs-4" role="tab">MY PAYMENT METHODS</a>
                    </li>
                    <li class="nav-item w-100">
                        <a class="nav-link" data-toggle="tab" href="#tabs-5" role="tab">HELP CENTER</a>
                    </li>
                    <li class="nav-item w-100">
                        <a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab">MORE</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-9 col-sm-12">
                <!-- Tab panes -->
                <div class="tab-content mt-3">
                    <div class="tab-pane active" id="tabs-1" role="tabpanel">
                        <h5>ยกเลิกบริการ</h5>
                        <hr />
                    </div>
                    <div class="tab-pane" id="tabs-2" role="tabpanel">
                        <table class="table table-borderless">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <h5>CONTACT INFORMATION</h5>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <p>First name</p>
                                    </td>
                                    <td class="text-right">
                                        <p>Taylor</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Last name</p>
                                    </td>
                                    <td class="text-right">
                                        <p>Swift</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Email Address</p>
                                    </td>
                                    <td class="text-right">
                                        <p>Taylor.Swift@gmail.com</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Mobile Number</p>
                                    </td>
                                    <td class="text-right">
                                        <p>+66123456789</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="table table-borderless mt-5">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <h5>SETTINGS</h5>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <p>Language</p>
                                    </td>
                                    <td class="text-right" style="color: #a33e3e">
                                        <p>English</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Change Password</p>
                                    </td>
                                    <td class="text-right" style="color: #a33e3e">
                                        <p>******</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Receive offers by email</p>
                                    </td>
                                    <td class="text-right">
                                        <label class="switch">
												<input type="checkbox" checked />
												<span class="slider round"></span>
											</label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-dark" style="width: 150px">SAVE</button>
                    </div>
                    <div class="tab-pane" id="tabs-3" role="tabpanel">
                        <h3>MY ADDERSS</h3>

                        <p><i class="fas fa-map-marker-alt" style="font-size: xx-large; color: #a33e3e"></i><b> HOME</b></p>
                        <i class="fas fa-pen float-right" type="button" style="font-size: large; color: #a33e3e"></i>
                        <p>365 Bond St. Chang Wat Nonthaburi 11120</p>
                        <p class="mb-5">Note to Barber : เอ็มโซไซตี้คอนโด เมืองทองธานี</p>
                        <button type="button" class="btn btn-dark">ADD NEW ADDRESS</button>
                    </div>
                    <div class="tab-pane" id="tabs-4" role="tabpanel">
                        <h3>PAYMENT METHODS</h3>
                        <table class="table mt-4" style="background-color: #faf9f7">
                            <tbody>
                                <tr>
                                    <td>
                                        COACH CRAFTSMAN<br />
                                        <p class="m-0" style="font-size: xx-small">Package A : Under Cut + ไถข้าง</p>
                                        <p class="text-black-50" style="font-size: xx-small">12 February 2020, 10.30 AM</p>
                                    </td>
                                    <td class="text-right">
                                        <p class="text-success" style="font-size: xx-small">Paid Successful</p>
                                        <h6><b>฿ 1,500</b></h6>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        COACH CRAFTSMAN<br />
                                        <p class="m-0" style="font-size: xx-small">Package A : Under Cut + ไถข้าง</p>
                                        <p class="text-black-50" style="font-size: xx-small">12 February 2020, 10.30 AM</p>
                                    </td>
                                    <td class="text-right">
                                        <p class="text-success" style="font-size: xx-small">Paid Successful</p>
                                        <h6><b>฿ 1,500</b></h6>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        COACH CRAFTSMAN<br />
                                        <p class="m-0" style="font-size: xx-small">Package A : Under Cut + ไถข้าง</p>
                                        <p class="text-black-50" style="font-size: xx-small">12 February 2020, 10.30 AM</p>
                                    </td>
                                    <td class="text-right">
                                        <p class="text-success" style="font-size: xx-small">Paid Successful</p>
                                        <h6><b>฿ 1,500</b></h6>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane" id="tabs-5" role="tabpanel">
                        <h3><b>HELP CENTER</b></h3>
                    </div>
                    <div class="tab-pane" id="tabs-6" role="tabpanel">
                        <h3><b>MORE</b></h3>
                        <hr />
                        <i class="fas fa-folder float-left" style="font-size: large; color: #a33e3e"></i>
                        <p>&nbsp;<b>SAVED</b></p>
                        <img src="images/m1.png" alt="" class="col-md-3 col-sm-12 p-2 float-left" />
                        <img src="images/m2.png" alt="" class="col-md-3 col-sm-12 p-2 float-left" />
                        <img src="images/m3.png" alt="" class="col-md-3 col-sm-12 p-2 float-left" />
                        <img src="images/m4.png" alt="" class="col-md-3 col-sm-12 p-2 float-left" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
                        <div class="text-center">
                            <h3>
                                <font class="text-danger">ยกเลิกบริการ</font>
                            </h3>

                            <p>ท่านยืนยันที่จะยกบริการใช่หรือไม่</p>
                            <button onclick="cancel()" class="btn btn-danger mt-4" style="background-color: #a33e3e">ยกเลิกบริการ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const listMonth = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];

        const formatDate = (date) => {
            console.log(date);
            return date.getDate() + ' ' + listMonth[date.getMonth()].toLocaleUpperCase() + ' ' + (date.getFullYear() + 543);
        };

        $(function() {
            $('#nav').load('layout/navbar.html');
            console.log(getUrlVars());
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'get_order_detail',
                    id: getUrlVars()['id'],
                },
                // contentType: false,
                // processData: false,
                dataType: 'json',
            }).done(function(msg) {
                let item = msg.result.sd;

                var dateFirst = new Date(item.service_date);
                var dateSecond = new Date();

                // time difference
                var timeDiff = Math.abs(dateSecond.getTime() - dateFirst.getTime());

                // days difference
                var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));

                $('#tabs-1').append(`
							<h4>${item.biz_name}</h4>
							<p>${item.name}</p>
							<p>${formatDate(new Date(item.service_date))}, ${item.service_time}</p>
							<p class="float-left font-weight-bold">ราคาบริการ</p>
							<p class="text-right font-weight-bold">${item.promotion_price || item.price} บาท</p>
							<hr />
							<p class="float-left">
								<font class="text-danger">ยกเลิกบริการ ณ วันที่ ${formatDate(new Date())}</font>
							</p>
							<p class="text-right">
								<font class="text-danger">หัก ${diffDays > 2 ? 0 : diffDays > 1 ? 10 : 20}%</font>
							</p>
							<p class="float-left font-weight-bold">รวมค่ายกเลิกบริการทั้งสิ้น <br /><small>( ยกเลิกล่วงหน้า ${diffDays} วัน )</small></p>
							<p class="text-right font-weight-bold">${diffDays > 2 ? 0 : diffDays > 1 ? 0.1 * (item.promotion_price || item.price) : 0.2 * (item.promotion_price || item.price)} บาท</p>
							<br /><br />
							<div class="form-check">
								<input class="form-check-input" type="checkbox" onchange="onChange(this)" value="" name="read" id="read" />
								<label class="form-check-label" for="read"> ยอมรับและอ่านเงื่อนไขการยกเลิกเรียบร้อยแล้ว </label>
							</div>
							<div class="text-center mt-5">
								<a href="user.html" class="btn btn-secondary mx-2">ย้อนกลับ</a>
								<button disabled="disabled" id="confirm" class="btn btn-danger mx-2" style="background-color: #a33e3e" data-toggle="modal" data-target="#exampleModal">ยกเลิกบริการ</button>
							</div>`);
            });
        });

        const onChange = (e) => {
            if ($('#read').prop('checked')) $('#confirm').removeAttr('disabled');
            else $('#confirm').attr('disabled', '');
        };

        function getUrlVars() {
            var vars = [],
                hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

        const cancel = () => {
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'change_status_order',
                    id: getUrlVars()['id'],
                    status: 0,
                },
                // contentType: false,
                // processData: false,
                dataType: 'json',
            }).done((msg) => {
                if (msg.code === 200) {
                    window.location.href = 'user.html';
                }
            });
        };
    </script>
</body>

</html>