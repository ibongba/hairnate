<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Enter your description here" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/review.css">
    <title>BOOKING HOME</title>
</head>

<body>
    <div id="nav"></div>
    <div style="max-height: 100vh; overflow: hidden;">
        <img id="image" src="https://via.placeholder.com/1920x600.png?text=ไม่มีรูป" alt="" class="w-100">
    </div>
    <div class="container">
        <div class="row my-5">
            <div class="col">
                <div class="mb-3">
                    <h5 class="float-left mt-2 mb-0" id="name"></h5>&nbsp;
                    <a id="ref" href="bookingCustomer.html" class="btn btn-danger" style="background-color: #A33E3E; border-radius: 25px;">จองคิว</a>
                </div>
                <p id="detail"></p>
            </div>
            <p class="mx-3">200 <br> review </p>
            <p style="border:1px #C1B09D solid;"></p>&nbsp;
            <p class="mx-3">100 <br> like</p>
            <p class="col-12 my-3" style="border:1px #C1B09D solid;"></p>&nbsp;
        </div>
        <div class="row mb-5">
            <div class="col-md-4 col-sm-12 align-items-center d-flex">
                <h2 class="btn btn-dark" style="border-radius: 25px; width: inherit;">
                    PROMOTION<br/> OF <span style="color:#A33E3E ;">THIS MONTH</span>
                </h2>
            </div>

            <div class="col-md-8 col-sm-12">
                <div class="row">
                    <div class="col-12 text-center mr-auto">
                        <div class="row pt-3" id="promotion">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-5 text-center">
            <div class="col-md-4 col-sm-12 pt-5">
                <h2 class="btn btn-dark" style="border-radius: 25px; width: inherit;">OUR TEAM</h2>
            </div>
            <div class="col-md-8 col-sm-12">
                <div class="row">
                    <div class="col-12 text-center mr-auto">
                        <div class="row pt-3" id="barber">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="team" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" style="background-color: black;">
                        <div class="modal-header">
                            <div class="icon m-0">
                                <div class="position-relative">
                                    <img class="circle" src="images/asset-1.png" style="width: 100px; height: 100px;" />
                                </div>
                            </div>
                            <div class="text-left pt-4 text-light">
                                <h4 class="mb-0">COACH</h4>
                                <p>ร้าน : Coach Craftsman</p>
                            </div>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                             <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body text-light">
                            <p>PORTFOLIO</p>
                            <div class="row">
                                <img src="images/asset-7.png" alt="" class="w-50 p-2">
                                <img src="images/asset-8.png" alt="" class="w-50 p-2">
                            </div>
                            <div class="row">
                                <img src="images/asset-9.png" alt="" class="w-50  p-2">
                                <img src="images/asset-10.png" alt="" class="w-50  p-2">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <hr class="col-12" style="border-bottom:1px solid #EEEBE6;" />
        </div>
        <div class="row mb-5">
            <div class="col-md-4 col-sm-12 pt-5">
                <h2 class="btn btn-dark" style="border-radius: 25px; width: inherit;">SERVICES TYPE</h2>
            </div>
            <div class="col-md-8 col-sm-12">
                <div class="row">
                    <div class="col-12 text-center mr-auto">
                        <div class="row pt-3" id="service">
                        </div>
                    </div>
                </div>
            </div>
            <hr class="col-12" style="border-bottom:1px solid #EEEBE6;" />
        </div>
        <h2 class="text-center">REVIEW OF <br>PHEEN BARBER SHOP</h2>
        <div class="row p-3">
            <div class="col-md-6 col-sm-12 p-0">
                <img src="images/C1.PNG" alt="" class="w-100 p-1 ">
                <img src="images/C2.PNG" alt="" class="w-100 col-md-6 col-sm-12 p-1 float-left rewiew-img">
                <img src="images/C3.png" alt="" class="w-100 col-md-6 col-sm-12 p-1 rewiew-img ">
            </div>
            <div class="col-md-6 col-sm-12 p-0">
                <img src="images/C4.jpg" alt="" class="w-100 p-1 rewiew-img2">
                <img src="images/C5.png" alt="" class="w-100 col-md-6 col-sm-12 p-1 float-left rewiew-img2">
                <img src="images/C6.png" alt="" class="w-100 col-md-6 col-sm-12 p-1 rewiew-img2">
                <img src="images/C7.png" alt="" class="w-100 p-1 rewiew-img3">
            </div>
            <a href="" class="col-12">
                <p class="text-black-50 text-right">
                    see more review >></p>
            </a>
            <hr class="col-12" style="border-bottom:1px solid #EEEBE6;" />
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="form-group p-0" style="width: 250px;">
                    <select id="inputState" class="form-control" onchange="onchangefilter()">
                        <option value="">CHOOSE HAIRSTYLE</option>
                        <!-- <option></option> -->
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group p-0" style="width: 250px;">
                    <select id="inputStateBarber" class="form-control" onchange="onchangefilterBarber()">
                        <option value="">CHOOSE BARBER</option>
                        <!-- <option></option> -->
                    </select>
                </div>
            </div>
        </div>
        <div id="review">

        </div>
        <a href="" class="col-12 mb-4">
            <p class="text-black-50 text-right">
                see more review >></p>
        </a>
    </div>
    <!-- container -->
    <footer>
        <div class="container ">
            <div class="foot_logo pt-5 ">
                <img class="logo-img center-block " src="images/logo-app-white.png " />
            </div>

            <div class="footer_text ">
                เว็บแอพพลิเคชั่นรวบรวมร้านตัดผมแฟชั่นชาย และตัดผลบริจาคแบบ Delivery ในเขตกรุงเทพมหานครและปริมณฑล
            </div>


            <div class="foot_icon ">
                <a href="# "><i class="fab fa-facebook "></i></a>
                <a href="# "><i class="fab fa-twitter "></i></a>
                <a href="# "><i class="fab fa-instagram "></i></a>
                <br>
                <a href="barber/login.html" class="text-danger" style="font-size: large;">LOGIN FOR BARBER</a>
            </div>
        </div>
    </footer>






    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        var user = JSON.parse(localStorage.getItem('user'));

        function getUrlVars() {
            var vars = [],
                hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        $(function() {
            $('#nav').load("layout/navbar.html");

            $('#ref').attr('href', 'bookingCustomer.html?id=' + getUrlVars()['id'])
            if (!localStorage.getItem('user')) $('#ref').addClass('d-none')

            $.ajax({
                method: "POST",
                url: "service/core.php",
                data: {
                    action: 'get_partner_with_id',
                    id: getUrlVars()['id']
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                let data = JSON.parse(msg.result)
                console.log('data', data);

                data.barber.map((item) => {
                    $('#barber').append(barberCard(item))
                })

                data.hairstyle.filter((item) => item.type === "2").map((item) => {
                    $('#promotion').append(serviceCard(item))
                })


                data.hairstyle.filter((item) => item.type === "1").map((item) => {
                    $('#service').append(serviceCard(item))
                })

                // let image = res.picture.filter((item) => res.result.fk_sd_id == item.fk_sd_id);
                for (i = 0; i < data.review.length; i++) {
                    let test = data.picture.filter((item) => data.review[i].id_service_detail == item.fk_sd_id);
                    $('#review').append(review(data.review[i], test))
                        // console.log(test)
                };
                // data.review.map((item, test) => {})
                console.log(data)
                $('#name').text(data.partner.biz_name)
                $('#detail').append('<i class="fas fa-map-marker-alt" style="color: #A33E3E;"></i> ' + data.partner.biz_house_no + (data.partner.biz_village_no ? ' หมู่ ' + data.partner.biz_village_no : '') + ' ' + data.partner.biz_sub_area + ' ' + data.partner.biz_area + ' ' + data.partner.biz_province + ' ' + data.partner.biz_postal_code)
                $('#image').attr('src', data.partner.biz_image || 'https://via.placeholder.com/1920x600.png?text=ไม่มีรูป')
            });
        });

        const onchangefilter = () => {
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'get_review_barber_filter',
                    // service_date: date,
                    id_hairstyle: $('#inputState option:selected').val(),
                    id: getUrlVars()['id'],
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                let data = msg;
                if (msg.code === 200) {
                    $('#review').empty();
                    // msg.result.map((item) => {
                    for (i = 0; i < data.result.length; i++) {
                        let test = data.picture.filter((item) => data.result[i].id_service_detail == item.fk_sd_id);
                        $('#review').append(review(data.result[i], test))
                        console.log(test)
                            // break;
                    };
                    // });
                    $('#cancel').text(msg.result.filter(item => item.status === 0).length)
                    $('#success').text(msg.result.filter(item => item.status === 3).length)
                    $('#all').text(msg.result.length)
                }
            });
        }

        $().ready(() => {
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'get_filter_hairstyle',
                    id: getUrlVars()['id'],
                },
                dataType: 'json',
            }).done(function(msg) {
                if (msg.code === 200) {
                    $('#filter').empty();
                    msg.result.map((item) => {
                        $('#inputState').append(inputState(item));
                        return;
                    });
                }
            });
        });

        inputState = (item) => {
            return `
            <option value="${item.id_hairstyle}">${item.name}</option>
			             `;
        };

        const onchangefilterBarber = () => {
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'get_review_barber_filter',
                    // service_date: date,
                    id_barber: $('#inputStateBarber option:selected').val(),
                    id: getUrlVars()['id'],
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                let data = msg;
                console.log(data)
                if (msg.code === 200) {
                    $('#review').empty();
                    // msg.result.map((item) => {
                    for (i = 0; i < data.result.length; i++) {
                        let test = data.picture.filter((item) => data.result[i].id_service_detail == item.fk_sd_id);
                        $('#review').append(review(data.result[i], test))
                            // console.log(test)
                    };
                    // return;
                    // });
                    $('#cancel').text(msg.result.filter(item => item.status === 0).length)
                    $('#success').text(msg.result.filter(item => item.status === 3).length)
                    $('#all').text(msg.result.length)
                }
            });
        }
        $().ready(() => {
            $.ajax({
                method: 'POST',
                url: 'service/core.php',
                data: {
                    action: 'get_filter',
                    id: getUrlVars()['id'],
                },
                dataType: 'json',
            }).done(function(msg) {
                if (msg.code === 200) {
                    $('#filter').empty();
                    msg.result.map((item) => {
                        $('#inputStateBarber').append(inputStateBarber(item));
                        return;
                    });
                }
            });
        });

        inputStateBarber = (item) => {
            return `
            <option value="${item.id_barber}">${item.name}</option>
			             `;
        };

        // const image_review = () => {
        //     for (i = 0; i < image.length; i++) {
        //         var img = image ? 'service/' + image[i].path : 'https://via.placeholder.com/150';
        //         console.log(img)
        //         var data = `
        //                     <div class="col-2">
        //                         <button  style="background-image: url(${img});  background-size: cover;
        //                         background-position: center; width:100px;height:100px" onclick="showPic(${img})"></button>
        //                     </div>
        //                     `;
        //         $('#show_img').append(data);

        //     };
        // }


        const review = (item, img_review) => {

            let data = '';
            for (let i = 0; i < img_review.length; i++) {
                var img = img_review ? img_review[i].path : 'https://via.placeholder.com/150';
                data += `
                        <button  style="background-image: url(${img});  background-size: cover;
                        background-position: center; width:50px;height:50px"></button>
                    `;
                // console.log(data)
            }

            return `
            <div class="card" style="background-color: #FAF9F7;">
                <div class="card-body"> 
                    <div id="img_review">
                        ${data}
                            <p>CUSTOMER NAME :<b>${item.username + ' ' + (item.surname ? item.surname : '')}</b></p>
                            <div class="text-review"><p class="float-left">REVIEW: ${item.detail}</p></div>
                        <p class="text-right"> REVIEW DATE :${item.review_date}</p>
                        
                    <div class="d-flex align-items-end flex-column" >

                        <img src="${item.barber_img}" style="width: 50px; height: 50px" class="mt-auto p-2 bd-highlight"  />
                    </div>                   
                </div>
            </div>`;
        }

        const serviceCard = (item) => {
                return `
            <div class="col-md-6">
                <div class="icon">
                    <div class="position-relative">
                        <img class="img-fluid img-thumbnail" src="${item.image}" />
                        <p style="text-align: center;" class="pt-2"><b>${item.name}</b><br>${item.promotion_price ? `<span style="text-decoration: line-through;">${item.price}</span> <span style="color: #A33E3E; font-size:20px">${item.promotion_price} Baht</span>` : item.price + ' Bath'} </p>
                    </div>
                </div>
            </div>
                        `
        }

            const barberCard = (item) => {
            return `
                            <div class="col-6 col-md-4 col-lg-3 mb-3">
                                <a href="" data-toggle="modal" data-target="#team" class="text-decoration-none"">
                                    <div class="icon">
                                        <div class="position-relative">
                                            <img class="circle" src="${item.image}" />
                                            <p style="text-align: center;" class="pt-2 text-dark">ช่าง ${item.name}</p>
                                            <p style="text-align: center;" class="pt-2 text-dark"> ${item.description}</p>
                                        </div>
                                    </div>
                                </a>
                            </div>`;
            }
    </script>
</body>

</html>