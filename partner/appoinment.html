<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="Description" content="Enter your description here" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <link href="../css/main.css" rel="stylesheet" />


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <title>Appoinment</title>
</head>
<style>
    input:checked+.slider {
        background-color: #a33e3e;
    }
</style>

<body>
    <div id="nav"></div>

    <div class="container">
        <div class="row my-5">
            <h2 class="col-md-6 ">APPOINMENTS</h2>
            <div class="col-md-4">
                <div class="form-group row pt-0 bg-succsee">
                    <div class="col-sm-8">
                        <input id="datepicker" width="276" placeholder="Choose date" /></div>

                </div>
            </div>
            <div class="form-group col p-0">
                <select id="inputState" class="form-control" onchange="onchangefilter()">
                  <option value="">FILTER</option>
                  <!-- <option></option> -->
                </select>
            </div>

        </div>
        <div class="row">
            <div class="col-md-9">
                <h3>วันที่ 22/10/2563</h3>
                <div class="mt-3 d-none" id="select">
                    <div class="row my-2">
                        <div class="col">
                            <button type="button" class="btn btn-danger" onclick="allMorning()" id="morning">ช่วงเช้า</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnMorning(9,'09.00')" id="9" style="background-color: black">09.00</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnMorning(10,'10.00')" id="10" style="background-color: black">10.00</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnMorning(11,'11.00')" id="11" style="background-color: black">11.00</button>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col">
                            <button type="button" class="btn btn-danger" onclick="allEvening()" i id="evening">ช่วงบ่าย</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnEvening(13,'13.00')" id="13" style="background-color: black">13.00</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnEvening(14,'14.00')" id="14" style="background-color: black">14.00</button>
                            <button type="button" class="btn btn-secondary" onclick="onClickBtnEvening(15,'15.00')" id="15" style="background-color: black">15.00</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 p-2">
                <div class="border border-dark p-4 rounded-lg">
                    <h5 class="float-left">จำนวน</h5>
                    <h5 class="text-right" id="all">10</h5>
                    <h5 class="float-left">สำเร็จ</h5>
                    <h5 class="text-right" id="success">0</h5>
                    <h5 class="float-left">ยกเลิก</h5>
                    <h5 class="text-right" id="cancel">5</h5>
                </div>
            </div>
        </div>
        <hr class="col-12" style="background-color: #eeebe6" />
        <table class="table table-striped text-center" id="table">
            <thead>
                <tr>
                    <th class="app-text">NO.</th>
                    <th class="app-text">SERVICE TIME</th>
                    <th class="app-text">CUSTOMER NAME</th>
                    <th class="app-text">SERVICE TYPE</th>
                    <th class="app-text">BARBER</th>
                    <th class="app-text">ADDRESS</th>
                    <th class="app-text">TEL.</th>
                    <th class="app-text">STATUS</th>
                    <th class="app-text">ALERT</th>
                </tr>
            </thead>
            <tbody id="detail"></tbody>
        </table>
    </div>
    <footer>
        <div class="container">
            <div class="foot_logo pt-5">
                <img class="logo-img center-block" src="../images/logo-app-white.png " />
            </div>

            <div class="footer_text">เว็บแอพพลิเคชั่นรวบรวมร้านตัดผมแฟชั่นชาย และตัดผลบริจาคแบบ Delivery ในเขตกรุงเทพมหานครและปริมณฑล</div>

            <div class="foot_icon">
                <a href="# "><i class="fab fa-facebook"></i></a>
                <a href="# "><i class="fab fa-twitter"></i></a>
                <a href="# "><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js "></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js "></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js "></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <script src="../js/main.js"></script>
    <script>
        $(function() {
            $('#nav').load('http://localhost/hairnate/layout/navbar.html');
        });
    </script>
    <script>
        $('#datepicker').datepicker({
            uiLibrary: 'bootstrap4'
        });
    </script>
    <script>
        var user = JSON.parse(localStorage.getItem('user'));

        function formatDate2(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [year, month, day].join('-');
        }
        var date = '';
        $('#datepicker').datepicker({
            uiLibrary: 'bootstrap4',
            dateFormat: 'yyyy-mm-dd'
        }).on("change", function() {
            console.log(this.value);
            date = formatDate2(this.value);
            $('#select').removeClass('d-none')
            $.ajax({
                method: 'POST',
                url: '../service/core.php',
                data: {
                    action: 'get_detail_order_by_customer',
                    service_date: date,
                    id_barber: $('#inputState option:selected').val(),
                    id: user.id,
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                // msg = JSON.parse(msg);
                console.log(msg)
                if (msg.code === 200) {
                    $('#detail').empty();
                    msg.result.map((item) => {
                        $('#detail').append(detail(item));
                        return;
                    });

                    $('#cancel').text(msg.result.filter(item => item.status === 0).length)
                    $('#success').text(msg.result.filter(item => item.status === 3).length)
                    $('#all').text(msg.result.length)
                }
            });
        });

        detail = (item) => {
            var img = item.image ? item.image : 'https://via.placeholder.com/150';
            const date = new Date(item.service_date);
            const result = date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
            });
            if (item.status == '0') {
                item.status = "cancel"
            } else if (item.status == '2') {
                item.status = "Paid"
            } else {
                item.status = "Finish"
            }
            return `
			             <tr class="app-text">
                            <th scope="row">${item.id_service_detail}</th>
                            <td>${item.service_time}</td>
                            <td>${item.customer_name}</td>
                            <td>${item.service_type}</td>
                            <td>${item.barber_name}</td>
                            <td>${item.address}</td>
                            <td>${item.phone}</td>
                            <td class="text-success">${item.status}</td>
                            <td><button type="button" class="btn btn-danger" style="min-width: auto;">Alert</button></td>
                        </tr>
			             `;
        };

        const onchangefilter = () => {
            $.ajax({
                method: 'POST',
                url: '../service/core.php',
                data: {
                    action: 'get_detail_order_by_customer',
                    service_date: date,
                    id_barber: $('#inputState option:selected').val(),
                    id: user.id,
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                console.log(msg)
                    // msg = JSON.parse(msg);
                console.log(msg)
                if (msg.code === 200) {
                    $('#detail').empty();
                    msg.result.map((item) => {
                        $('#detail').append(detail(item));
                        return;
                    });

                    $('#cancel').text(msg.result.filter(item => item.status === 0).length)
                    $('#success').text(msg.result.filter(item => item.status === 3).length)
                    $('#all').text(msg.result.length)
                }
            });
        }

        $().ready(() => {
            $.ajax({
                method: 'POST',
                url: '../service/core.php',
                data: {
                    action: 'get_filter',
                    id: user.id,
                },
                dataType: 'json',
            }).done(function(msg) {
                if (msg.code === 200) {
                    $('#filter').empty();
                    msg.result.map((item) => {
                        $('#inputState').append(inputState(item));
                        return;
                    });
                }
            });
        });

        inputState = (item) => {
            return `
            <option value="${item.id_barber}">${item.name}</option>
			             `;
        };

        remove = (time) => {
            $.ajax({
                method: 'POST',
                url: '../service/core.php',
                data: {
                    action: 'remove_closed',
                    date: date,
                    time: time,
                    user_id: user.id,
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            })
        }

        add = (time) => {
            $.ajax({
                method: 'POST',
                url: '../service/core.php',
                data: {
                    action: 'add_closed',
                    date: date,
                    time: time,
                    user_id: user.id,
                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            })
        }

        onClickBtnMorning = (id,time) => {
            if($('#'+id).hasClass('disabled')){
                $('#morning').removeClass('disabled');
                $('#'+id).removeClass('disabled');

                remove(time)
            }else{
                $('#'+id).addClass('disabled');

                add(time)

                if($('#9').hasClass('disabled') && $('#10').hasClass('disabled') && $('#11').hasClass('disabled')){
                    $('#morning').addClass('disabled');
                }
            }
        }

        onClickBtnEvening = (id,time) => {
            if($('#'+id).hasClass('disabled')){
                $('#evening').removeClass('disabled');
                $('#'+id).removeClass('disabled');

                remove(time)
            }else{
                $('#'+id).addClass('disabled');

                add(time)

                if($('#13').hasClass('disabled') && $('#14').hasClass('disabled') && $('#15').hasClass('disabled')){
                    $('#evening').addClass('disabled');
                }
            }
        }

        allMorning = () => {

            if($('#morning').hasClass('disabled')){

                $('#morning').removeClass('disabled');
                $('#9').removeClass('disabled');
                $('#10').removeClass('disabled');
                $('#11').removeClass('disabled');

                remove('09.00')
                remove('10.00')
                remove('11.00')
            }else{
                $('#morning').addClass('disabled');
                $('#9').addClass('disabled');
                $('#10').addClass('disabled');
                $('#11').addClass('disabled');

                add('09.00')
                add('10.00')
                add('11.00')

            }
        }

        allEvening = () => {

            if($('#evening').hasClass('disabled')){

                $('#evening').removeClass('disabled');
                $('#13').removeClass('disabled');
                $('#14').removeClass('disabled');
                $('#15').removeClass('disabled');

                remove('13.00')
                remove('14.00')
                remove('15.00')
            }else{
                $('#evening').addClass('disabled');
                $('#13').addClass('disabled');
                $('#14').addClass('disabled');
                $('#15').addClass('disabled');

                add('13.00')
                add('14.00')
                add('15.00')

            }
        }


    </script>
</body>

</html>